<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChronoShelf - AI Inventory Management</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #0a0a2a, #1a2a6c, #2a3a9c); color: #fff; min-height: 100vh; }
        
        /* Splash Screen */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a2a, #1a2a6c);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .splash-logo {
            font-size: 4rem;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 20px #00ffff;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Auth Screens */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a2a, #1a2a6c);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            padding: 20px;
        }
        
        .auth-card {
            background: rgba(0,0,0,0.8);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #00ffff;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .app-title {
            font-size: 2.5rem;
            color: #00ffff;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ffff;
        }
        
        .app-subtitle {
            font-size: 1rem;
            color: #00ffff;
            margin-bottom: 30px;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #00ffff;
        }
        
        .auth-tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: #00ffff;
            cursor: pointer;
            font-weight: bold;
        }
        
        .auth-tab.active {
            background: #00ffff;
            color: #0a0a2a;
            border-radius: 8px 8px 0 0;
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group { 
            display: flex; 
            flex-direction: column; 
            gap: 5px; 
            margin-bottom: 15px; 
            text-align: left;
        }
        
        .form-group label { 
            font-size: 0.9rem; 
            font-weight: bold; 
            color: #00ffff;
        }
        
        .form-group input, .form-group select { 
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            background: rgba(255,255,255,0.1); 
            color: white; 
        }
        
        /* Main App */
        .main-app { display: none; padding: 15px; }
        .container { max-width: 100%; margin: 0 auto; }
        header { text-align: center; padding: 15px 0; margin-bottom: 20px; }
        h1 { font-size: 2rem; color: #00ffff; margin-bottom: 5px; text-shadow: 0 0 10px #00ffff; }
        .card { background: rgba(0,0,0,0.7); border-radius: 12px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(0,255,255,0.3); }
        
        /* User Menu */
        .user-menu {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #00ffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #0a0a2a;
            cursor: pointer;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .quick-action-btn {
            padding: 12px;
            background: rgba(0,255,255,0.1);
            border: 2px solid #00ffff;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .quick-action-btn:hover {
            background: rgba(0,255,255,0.3);
            transform: translateY(-2px);
        }

        /* Enhanced Dropdown */
        .enhanced-dropdown {
            position: relative;
            width: 100%;
        }
        
        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.95);
            border: 1px solid #00ffff;
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        
        .dropdown-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0,255,255,0.2);
        }
        
        .dropdown-item:hover {
            background: rgba(0,255,255,0.2);
        }
        
        .product-suggestions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 10px;
        }
        
        .suggestion-btn {
            padding: 10px 12px;
            background: rgba(0,255,255,0.2);
            border: 1px solid #00ffff;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            text-align: center;
        }

        /* Real Camera Scanner */
        .camera-scanner-modal {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .camera-container {
            width: 100%;
            max-width: 400px;
            height: 400px;
            background: #000;
            border: 3px solid #00ffff;
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        #camera-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .scan-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 150px;
            border: 2px solid #00ffff;
            border-radius: 10px;
        }
        
        .shutter-btn {
            background: linear-gradient(45deg, #ff0080, #00ffff);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 10px;
        }

        /* Chat Bot */
        .chat-bot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            height: 400px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #00ffff;
            border-radius: 15px;
            display: none;
            flex-direction: column;
            z-index: 1000;
        }
        
        .chat-header {
            background: #00ffff;
            color: #0a0a2a;
            padding: 15px;
            border-radius: 13px 13px 0 0;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }
        
        .chat-message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
            max-width: 80%;
        }
        
        .message-bot {
            background: rgba(0,255,255,0.2);
            align-self: flex-start;
        }
        
        .message-user {
            background: rgba(255,0,128,0.2);
            align-self: flex-end;
            margin-left: auto;
        }
        
        .chat-input {
            display: flex;
            padding: 10px;
            border-top: 1px solid #00ffff;
        }
        
        .chat-input input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 20px;
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .chat-send {
            background: #00ffff;
            color: #0a0a2a;
            border: none;
            border-radius: 20px;
            padding: 10px 15px;
            margin-left: 10px;
            cursor: pointer;
        }
        
        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff0080, #00ffff);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 5px 15px rgba(0,255,255,0.3);
        }

        /* Notification System */
        .alert-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1001;
            display: none;
            animation: slideDown 0.5s ease;
        }
        
        @keyframes slideDown {
            from { top: -100px; }
            to { top: 20px; }
        }

        /* Save Button */
        .save-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
        }

        /* Staff Connection */
        .staff-connection {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #27ae60;
        }
        
        .status-indicator.offline {
            background: #e74c3c;
        }

        /* Existing styles for other elements... */
        .btn { 
            padding: 14px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            transition: all 0.3s; 
        }
        
        .btn-primary { background: #00a8ff; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-premium { 
            background: linear-gradient(45deg, #ff0080, #00ffff); 
            color: white; 
            font-size: 1.1rem; 
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ffff;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #27ae60;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .notification.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-logo">MINDTECH</div>
    </div>

    <!-- Authentication Screen -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-card">
            <div class="app-title">ChronoShelf</div>
            <div class="app-subtitle">AI Powered Inventory Management System</div>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="showAuthForm('login')">Login</button>
                <button class="auth-tab" onclick="showAuthForm('register')">Register</button>
                <button class="auth-tab" onclick="showAuthForm('pricing')">Pricing</button>
            </div>
            
            <!-- Login Form -->
            <div class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" placeholder="your@business.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn btn-primary" onclick="login()">üîê Login</button>
                <p style="margin-top: 15px; font-size: 0.9rem;">
                    <a href="#" style="color: #00ffff;" onclick="showAuthForm('reset')">Forgot password?</a>
                </p>
            </div>
            
            <!-- Register Form -->
            <div class="auth-form" id="registerForm">
                <div class="form-group">
                    <label>Business Name</label>
                    <input type="text" id="registerBusiness" placeholder="Your Store Name">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="registerEmail" placeholder="your@business.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="registerPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>Staff Code (Optional)</label>
                    <input type="text" id="staffCode" placeholder="Connect to existing team">
                </div>
                <div class="form-group">
                    <label>Plan</label>
                    <select id="registerPlan">
                        <option value="free">Free Trial - 14 Days</option>
                        <option value="starter">Starter - R99/month</option>
                        <option value="business">Business - R299/month</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="register()">üöÄ Start Free Trial</button>
            </div>
            
            <!-- Pricing Form -->
            <div class="auth-form" id="pricingForm">
                <div class="plan-card">
                    <h3>Free Trial</h3>
                    <div style="font-size: 2rem; font-weight: bold;">R0</div>
                    <div style="font-size: 0.9rem;">14 days free</div>
                </div>
                
                <div class="plan-card">
                    <h3>Starter</h3>
                    <div style="font-size: 2rem; font-weight: bold;">R99</div>
                    <div style="font-size: 0.9rem;">per month</div>
                </div>
                
                <div class="plan-card">
                    <h3>Business</h3>
                    <div style="font-size: 2rem; font-weight: bold;">R299</div>
                    <div style="font-size: 0.9rem;">per month</div>
                </div>
                
                <button class="btn btn-premium" onclick="showAuthForm('register')">üí≥ Start Free Trial</button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <!-- User Menu -->
        <div class="user-menu">
            <div class="user-avatar" id="userAvatar">U</div>
            <button class="btn-logout" onclick="logout()">Logout</button>
        </div>

        <div class="container">
            <header>
                <h1>üõí ChronoShelf</h1>
                <p>AI Powered Inventory Management System</p>
                <p style="font-size: 0.8rem; color: #00ffff;" id="userPlan">Free Plan ‚Ä¢ <a href="#" style="color: #ff0080;" onclick="showBilling()">Upgrade</a></p>
            </header>

            <!-- Quick Actions -->
            <div class="card">
                <h2>‚ö° Quick Actions</h2>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="openCameraScanner()">
                        <div style="font-size: 1.5rem;">üì∑</div>
                        <div>Camera Scan</div>
                    </button>
                    <button class="quick-action-btn" onclick="openManualCapture()">
                        <div style="font-size: 1.5rem;">üìù</div>
                        <div>Manual Add</div>
                    </button>
                    <button class="quick-action-btn" onclick="exportData()">
                        <div style="font-size: 1.5rem;">üíæ</div>
                        <div>Export Data</div>
                    </button>
                </div>

                <!-- Staff Connection -->
                <div class="staff-connection">
                    <div class="connection-status">
                        <div class="status-indicator" id="connectionStatus"></div>
                        <span>Team Connection: <span id="connectionText">Online</span></span>
                    </div>
                    <div style="font-size: 0.8rem; color: #00ffff;">
                        Share code: <strong id="teamCode">TEAM-${Math.random().toString(36).substr(2, 6).toUpperCase()}</strong>
                    </div>
                </div>
            </div>

            <!-- Add Product Card -->
            <div class="card" id="inventorySection">
                <h2>üì¶ Add Product</h2>
                <form id="product-form">
                    <!-- Your existing product form fields -->
                    <div class="form-group">
                        <label>Category</label>
                        <select id="product-category" required onchange="updateProductDropdown()">
                            <option value="">Select Category</option>
                            <option value="dairy">Dairy & Eggs</option>
                            <option value="meat">Meat & Poultry</option>
                            <option value="produce">Fruits & Vegetables</option>
                            <option value="bakery">Bakery & Bread</option>
                            <option value="frozen">Frozen Foods</option>
                            <option value="beverages">Beverages</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Product Name</label>
                        <div class="enhanced-dropdown">
                            <input type="text" id="product-name" placeholder="Start typing or select from dropdown" 
                                   onfocus="showProductDropdown()" oninput="filterProducts()">
                            <div class="dropdown-list" id="product-dropdown"></div>
                        </div>
                        <div class="product-suggestions" id="product-suggestions"></div>
                    </div>

                    <div class="form-group">
                        <label>Barcode</label>
                        <input type="text" id="barcode" placeholder="Will be auto-filled from camera scan">
                    </div>

                    <div class="form-group">
                        <label>Expiry Date</label>
                        <input type="date" id="expiry-date" required>
                    </div>

                    <div class="form-group">
                        <label>Quantity</label>
                        <input type="number" id="quantity" value="1" min="1" required>
                    </div>

                    <button type="submit" class="save-btn">üíæ SAVE PRODUCT</button>
                </form>
            </div>

            <!-- Inventory Dashboard -->
            <div class="card">
                <h2>üìä Inventory Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-items">0</div>
                        <div class="stat-label">Total Items</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="expiring-soon">0</div>
                        <div class="stat-label">Expiring Soon</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-value">R0</div>
                        <div class="stat-label">Total Value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="waste-risk">0%</div>
                        <div class="stat-label">Waste Risk</div>
                    </div>
                </div>
                
                <div id="inventory-list" style="margin-top: 15px;">
                    <div class="inventory-item">No products yet. Add your first product!</div>
                </div>
            </div>

            <!-- Alert Notifications -->
            <div class="alert-notification" id="alertNotification">
                <strong>üö® ALERT:</strong> <span id="alertMessage"></span>
            </div>
        </div>
    </div>

    <!-- Real Camera Scanner Modal -->
    <div class="camera-scanner-modal" id="cameraScannerModal">
        <div class="camera-container">
            <video id="camera-video" autoplay playsinline></video>
            <div class="camera-overlay">
                <div class="scan-frame"></div>
            </div>
        </div>
        
        <button class="shutter-btn" onclick="captureBarcode()">
            üì∑ CAPTURE BARCODE
        </button>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 400px;">
            <button class="btn btn-secondary" onclick="switchCamera()">üîÑ Switch Camera</button>
            <button class="btn btn-secondary" onclick="closeCameraScanner()">‚ùå Close</button>
        </div>
        
        <div id="scan-result" style="margin-top: 15px; color: #00ffff; text-align: center;"></div>
    </div>

    <!-- AI Chat Bot -->
    <button class="chat-toggle" onclick="toggleChat()">üí¨</button>
    
    <div class="chat-bot" id="chatBot">
        <div class="chat-header">
            <span>ü§ñ ChronoShelf Assistant</span>
            <button onclick="toggleChat()" style="background: none; border: none; color: #0a0a2a; cursor: pointer;">‚úï</button>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message message-bot">
                Hello! I'm your inventory assistant. I'll notify you about stock levels, expiry dates, and team updates.
            </div>
        </div>
        <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Type your message...">
            <button class="chat-send" onclick="sendChatMessage()">Send</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // ===== SPLASH SCREEN =====
        setTimeout(() => {
            document.getElementById('splashScreen').style.display = 'none';
            document.getElementById('authScreen').style.display = 'flex';
        }, 9000); // 9 seconds

        // ===== REAL CAMERA SCANNER =====
        let videoStream = null;
        let currentCamera = 'environment'; // 'user' for front, 'environment' for back

        async function openCameraScanner() {
            const modal = document.getElementById('cameraScannerModal');
            modal.style.display = 'flex';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: currentCamera }
                });
                
                const video = document.getElementById('camera-video');
                video.srcObject = stream;
                videoStream = stream;
                
            } catch (error) {
                document.getElementById('scan-result').innerHTML = 
                    '‚ùå Camera access denied. Using manual scanner instead.';
                setTimeout(() => {
                    closeCameraScanner();
                    openScanner(); // Fallback to manual scanner
                }, 2000);
            }
        }

        function closeCameraScanner() {
            const modal = document.getElementById('cameraScannerModal');
            modal.style.display = 'none';
            
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
                videoStream = null;
            }
        }

        async function switchCamera() {
            if (videoStream) {
                videoStream.getTracks().forEach(track => track.stop());
            }
            
            currentCamera = currentCamera === 'environment' ? 'user' : 'environment';
            await openCameraScanner();
        }

        function captureBarcode() {
            // Play shutter sound
            playShutterSound();
            
            // Simulate barcode detection (in real app, use a barcode detection library)
            const simulatedBarcodes = [
                '6001057001012', '6001057001029', '6001057001036', 
                '6001057002010', '6001057003017', '6001057004014'
            ];
            const randomBarcode = simulatedBarcodes[Math.floor(Math.random() * simulatedBarcodes.length)];
            
            document.getElementById('scan-result').innerHTML = 
                `‚úÖ Barcode detected: ${randomBarcode}`;
            
            // Auto-fill the form after 1 second
            setTimeout(() => {
                processScannedBarcode(randomBarcode);
                closeCameraScanner();
            }, 1000);
        }

        function playShutterSound() {
            // Create shutter sound using Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(1000, audioContext.currentTime);
            gainNode.gain.setValueAtTime(1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }

        function processScannedBarcode(barcode) {
            // Find product in database and auto-fill form
            const product = findProductByBarcode(barcode);
            
            if (product) {
                document.getElementById('product-name').value = product.name;
                document.getElementById('barcode').value = product.barcode;
                document.getElementById('product-category').value = product.category;
                showNotification(`‚úÖ Scanned: ${product.name}`);
            } else {
                document.getElementById('product-name').value = 'New Scanned Product';
                document.getElementById('barcode').value = barcode;
                showNotification('üì¶ New product scanned - please complete details');
            }
            
            document.getElementById('quantity').focus();
        }

        // ===== AI CHAT BOT =====
        function toggleChat() {
            const chat = document.getElementById('chatBot');
            chat.style.display = chat.style.display === 'flex' ? 'none' : 'flex';
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (message) {
                addChatMessage(message, 'user');
                input.value = '';
                
                // Auto-reply based on message content
                setTimeout(() => generateBotResponse(message), 1000);
            }
        }

        function addChatMessage(message, sender) {
            const messages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message message-${sender}`;
            messageDiv.textContent = message;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        function generateBotResponse(userMessage) {
            let response = "I'm here to help with inventory management!";
            const lowerMessage = userMessage.toLowerCase();
            
            if (lowerMessage.includes('stock') || lowerMessage.includes('low')) {
                const lowStockCount = checkLowStock();
                response = lowStockCount > 0 ? 
                    `üö® ${lowStockCount} items are running low on stock! Check the inventory dashboard.` :
                    "All stock levels are good! ‚úÖ";
                    
            } else if (lowerMessage.includes('expir') || lowerMessage.includes('date')) {
                const expiringCount = checkExpiringSoon();
                response = expiringCount > 0 ?
                    `‚è∞ ${expiringCount} items are expiring soon! Check the expiry alerts.` :
                    "No items expiring soon! ‚úÖ";
                    
            } else if (lowerMessage.includes('team') || lowerMessage.includes('staff')) {
                response = "Your team is connected! Share code: " + document.getElementById('teamCode').textContent;
                
            } else if (lowerMessage.includes('report') || lowerMessage.includes('issue')) {
                response = "Anonymous report received ‚úÖ Management will review it shortly.";
                showAlert("New anonymous report submitted");
                
            } else if (lowerMessage.includes('meeting') || lowerMessage.includes('staff meeting')) {
                response = "üìÖ Staff meeting scheduled for tomorrow at 10 AM. All team members notified!";
                showAlert("Staff meeting reminder: Tomorrow 10 AM");
            }
            
            addChatMessage(response, 'bot');
        }

        // ===== ALERT SYSTEM =====
        function showAlert(message) {
            const alert = document.getElementById('alertNotification');
            document.getElementById('alertMessage').textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function checkLowStock() {
            const lowStock = inventory.filter(item => item.quantity <= 3);
            if (lowStock.length > 0) {
                showAlert(`${lowStock.length} items running low on stock!`);
                addChatMessage(`üö® Low stock alert: ${lowStock.length} items need attention!`, 'bot');
            }
            return lowStock.length;
        }

        function checkExpiringSoon() {
            const today = new Date();
            const expiring = inventory.filter(item => {
                const days = Math.ceil((new Date(item.expiryDate) - today) / (1000 * 60 * 60 * 24));
                return days <= 3;
            });
            if (expiring.length > 0) {
                showAlert(`${expiring.length} items expiring in 3 days!`);
                addChatMessage(`‚è∞ Expiry alert: ${expiring.length} items expiring soon!`, 'bot');
            }
            return expiring.length;
        }

        // ===== STAFF CONNECTION SYSTEM =====
        function updateConnectionStatus() {
            const status = document.getElementById('connectionStatus');
            const text = document.getElementById('connectionText');
            
            // Simulate connection status
            const isOnline = Math.random() > 0.1; // 90% online
            if (isOnline) {
                status.className = 'status-indicator';
                text.textContent = 'Online - Team Connected';
            } else {
                status.className = 'status-indicator offline';
                text.textContent = 'Offline - Working Alone';
            }
        }

        // ===== AUTO DATA SYNC =====
        function setupAutoSync() {
            // Auto-save every 30 seconds
            setInterval(() => {
                if (inventory.length > 0) {
                    saveInventory();
                    addChatMessage('üíæ Auto-save completed successfully', 'bot');
                }
            }, 30000);
            
            // Check for alerts every minute
            setInterval(() => {
                checkLowStock();
                checkExpiringSoon();
            }, 60000);
        }

        // ===== ENHANCED PRODUCT DATABASE =====
        function findProductByBarcode(barcode) {
            for (const category in productDatabase) {
                const product = productDatabase[category].find(p => p.barcode === barcode);
                if (product) {
                    product.category = category;
                    return product;
                }
            }
            return null;
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize connection status
            setInterval(updateConnectionStatus, 10000);
            updateConnectionStatus();
            
            // Setup auto-sync
            setupAutoSync();
            
            // Your existing initialization code...
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expiry-date').value = today;
        });

        // Your existing product database, inventory management, and other functions...
        // (Include all the previous functionality from the enhanced version)

        // Make sure to include all your existing functions like:
        // - AuthService
        // - productDatabase  
        // - inventory management functions
        // - dropdown systems
        // - etc.

        // For brevity, I've included the core new features. You'll need to integrate with your existing code.

    </script>
</body>
</html>